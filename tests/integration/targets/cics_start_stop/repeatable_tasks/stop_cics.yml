- name: Issue shutdown command
  ibm.ibm_zos_cics.stop_cics:
    job_id: "{{ start_result.job_id }}"
    mode: "{{ mode }}"
  register: stop_result

- name: Log output of stop
  ansible.builtin.debug:
    msg: "{{ stop_result }}"

- name: Assert CICS stop did not fail
  ansible.builtin.assert:
    that:
      - stop_result.failed != True
      - stop_result.executions[2].return.jobs | selectattr("ret_code", 'equalto', None) | list | length == 0
    fail_msg: "CICS Region did not stop successfully"

- name: Execute an operator command to delete job
  ibm.ibm_zos_core.zos_operator:
    cmd: "\\$P JOB''{{ start_region_applid }}''"
